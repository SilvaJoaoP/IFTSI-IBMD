generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  PASTOR
  TESOUREIRO
  SECRETARIO
  DIACONO
  MIDIA
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  nome      String
  cpf       String?   @unique
  senha     String
  cargo     Role
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum SituacaoMembro {
  MEMBRO
  CONGREGADO
  AFASTADO
}

enum TipoParentesco {
  PAI
  MAE
  FILHO
  FILHA
  ESPOSO
  ESPOSA
  IRMAO
  IRMA
  OUTRO
}

model Membro {
  id        String    @id @default(cuid())
  nome      String
  cpf       String?   @unique
  email     String?
  telefone  String?

  // Endere√ßo
  rua       String?
  numero    String?
  bairro    String?
  cidade    String?
  estado    String?
  cep       String?

  situacao  SituacaoMembro @default(MEMBRO)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relacionamentos
  parentesOrigem  Parentesco[] @relation("MembroOrigem")
  parentesDestino Parentesco[] @relation("MembroDestino")
}

model Parentesco {
  id              String @id @default(cuid())
  membroOrigemId  String
  membroDestinoId String
  tipo            TipoParentesco

  membroOrigem    Membro @relation("MembroOrigem", fields: [membroOrigemId], references: [id], onDelete: Cascade)
  membroDestino   Membro @relation("MembroDestino", fields: [membroDestinoId], references: [id], onDelete: Cascade)

  @@unique([membroOrigemId, membroDestinoId])
}

model Album {
  id          String   @id @default(cuid())
  titulo      String
  capaUrl     String?  @db.Text
  dataEvento  DateTime @default(now())

  midias      Midia[]

  createdAt   DateTime @default(now())
}

model Midia {
  id          String    @id @default(cuid())
  url         String    @db.Text
  descricao   String?
  tipo        String

  albumId     String
  album       Album     @relation(fields: [albumId], references: [id], onDelete: Cascade)

  createdAt   DateTime  @default(now())
}

model Planilha {
  id        String    @id @default(cuid())
  mes       String
  ano       Int

  registros RegistroFinanceiro[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([mes, ano])
}

enum TipoRegistro {
  ENTRADA
  SAIDA_VARIAVEL
  SAIDA_FIXA
}

model RegistroFinanceiro {
  id             String        @id @default(cuid())
  descricao      String
  valor          Float
  data           DateTime
  tipo           TipoRegistro

  contaDigital   Boolean       @default(false)
  recorrente     Boolean       @default(false)
  ativo          Boolean       @default(true)

  parcelaAtual   Int?
  totalParcelas  Int?
  grupoId        String?

  comprovanteUrl String?       @db.Text

  planilhaId     String
  planilha       Planilha      @relation(fields: [planilhaId], references: [id], onDelete: Cascade)

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
}

model DocumentFolder {
  id        String         @id @default(cuid())
  name      String

  files     DocumentFile[]

  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}

model DocumentFile {
  id        String         @id @default(cuid())
  name      String
  url       String         @db.Text
  type      String         @default("PDF")

  folderId  String
  folder    DocumentFolder @relation(fields: [folderId], references: [id], onDelete: Cascade)

  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}