generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  PASTOR
  TESOUREIRO
  SECRETARIO
  DIACONO
  MIDIA
  MEMBRO
}

enum AccountStatus {
  ACTIVE
  SUSPENDED
  DEACTIVATED
}

model User {
  id             String        @id @default(cuid())
  email          String        @unique
  nome           String
  cpf            String?       @unique
  senha          String
  cargo          Role
  status         AccountStatus @default(ACTIVE)
  suspendedUntil DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  escalas        EscalaItem[]
}

enum SituacaoMembro {
  MEMBRO
  CONGREGADO
  AFASTADO
}

enum TipoParentesco {
  PAI
  MAE
  FILHO
  FILHA
  ESPOSO
  ESPOSA
  IRMAO
  IRMA
  OUTRO
}

model Membro {
  id          String    @id @default(cuid())
  nome        String
  cpf         String?   @unique
  email       String?
  telefone    String?
  
  // Endere√ßo
  rua         String?
  numero      String?
  bairro      String?
  cidade      String?
  estado      String?
  cep         String?

  situacao    SituacaoMembro @default(MEMBRO)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relacionamentos
  parentesOrigem  Parentesco[] @relation("MembroOrigem")
  parentesDestino Parentesco[] @relation("MembroDestino")
}

model Parentesco {
  id              String @id @default(cuid())
  membroOrigemId  String
  membroDestinoId String
  tipo            TipoParentesco
  
  membroOrigem    Membro @relation("MembroOrigem", fields: [membroOrigemId], references: [id], onDelete: Cascade)
  membroDestino   Membro @relation("MembroDestino", fields: [membroDestinoId], references: [id], onDelete: Cascade)

  @@unique([membroOrigemId, membroDestinoId])
}

model TransacaoFinanceira {
  id          String    @id @default(cuid())
  descricao   String
  valor       Float
  tipo        String  
  data        DateTime  @default(now())
}

// Modelo de Eventos
model Evento {
  id          String    @id @default(cuid())
  titulo      String
  descricao   String?
  links       String?   // Vamos armazenar como JSON string ou texto
  dataInicio  DateTime
  dataFim     DateTime?
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Escala {
  id        String       @id @default(cuid())
  titulo    String
  descricao String?
  data      DateTime
  items     EscalaItem[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model EscalaItem {
  id        String   @id @default(cuid())
  escalaId  String
  usuarioId String
  funcao    String
  
  escala    Escala   @relation(fields: [escalaId], references: [id], onDelete: Cascade)
  usuario   User     @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@index([escalaId])
  @@index([usuarioId])
}

model Midia {
  id        String    @id @default(cuid())
  url  String  @db.Text
  descricao String?
  tipo      String    
  albumId   String
  album     Album    @relation(fields: [albumId], references: [id], onDelete: Cascade)
  createdAt DateTime  @default(now())
}

model Album {
  id        String   @id @default(cuid())
  titulo    String
  capaUrl String? @db.Text 
  dataEvento DateTime @default(now())
  midias    Midia[]  
  createdAt DateTime @default(now())
}

model DocumentFolder {
  id        String         @id @default(cuid())
  name      String
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  files     DocumentFile[]
}

model DocumentFile {
  id        String         @id @default(cuid())
  name      String
  url       String         @db.Text
  type      String         @default("PDF")
  folderId  String
  folder    DocumentFolder @relation(fields: [folderId], references: [id], onDelete: Cascade)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
}